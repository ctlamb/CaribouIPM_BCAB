<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
box-sizing: border-box;
min-width: 200px;
max-width: 980px;
margin: 0 auto;
padding: 45px;
padding-top: 0px;
}
</style>


</head>

<body>

<h1 id="bc-ab-caribou-ipm-run">BC AB Caribou IPM run</h1>
<p>Clayton T. Lamb 27 December, 2023</p>
<h2 id="load-data">Load Data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(renv)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##to pull packages</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#restore(repos=&quot;https://cloud.r-project.org&quot;)</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(tidylog)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Load data ---------------------------------------------------------------</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>hd <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/clean/blueprint.csv&quot;</span>))</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>hn <span class="ot">&lt;-</span> hd <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, herd_num)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>sgt <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/clean/herd_sightability.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    <span class="fu">arrange</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    <span class="fu">left_join</span>(hn, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>afs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/clean/survival.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>    <span class="fu">arrange</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>    <span class="fu">left_join</span>(hn, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>afr <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/clean/recruitment.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>    <span class="fu">arrange</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>    <span class="fu">left_join</span>(hn, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>)</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/clean/counts.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>    <span class="fu">arrange</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>    <span class="fu">left_join</span>(hn, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>)</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>trt <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/clean/treatments.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>    <span class="fu">arrange</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>    <span class="fu">left_join</span>(hn, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>)</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>ecotype <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/raw/treatment.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">herd=</span>Herd,<span class="at">ECCC=</span>ECCC_Recov_Grp, <span class="at">COSEWIC=</span>COSEWIC_Grp, <span class="at">Heard_Vagt1998=</span>Heard.and.Vagt.<span class="fl">1998.</span>grouping)<span class="sc">%&gt;%</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>sexratios <span class="ot">&lt;-</span>  <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/clean/sexratios.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>  <span class="fu">arrange</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>  <span class="fu">left_join</span>(hn, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>)</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>sexratio_summary <span class="ot">&lt;-</span>  <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data/clean/sexratio_summary.csv&quot;</span>))</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a><span class="co"># 0 = treatment did not occur for that herd in that year</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a><span class="co"># 1 = treatment did occur</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="co"># NA = herd not monitored? Possibly change to 0s</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="co">#trt$applied[is.na(trt$applied)] &lt;- 0</span></span></code></pre></div>
<h2 id="prep-data-for-ipm">Prep data for IPM</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Herds and herd number</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>herds <span class="ot">&lt;-</span> <span class="fu">unique</span>(hd<span class="sc">$</span>herd)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>nherd <span class="ot">&lt;-</span> <span class="fu">nrow</span>(hn)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>hd <span class="ot">&lt;-</span> hd<span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="fu">left_join</span>(ecotype<span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>              <span class="fu">add_row</span>(<span class="at">herd=</span><span class="st">&quot;Quintette Full&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>                      <span class="at">ECCC=</span><span class="st">&quot;Central Group&quot;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>                      <span class="at">COSEWIC=</span><span class="st">&quot;DU8&quot;</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>                      <span class="at">Heard_Vagt1998=</span><span class="st">&quot;Northern&quot;</span>), <span class="at">by=</span><span class="st">&quot;herd&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>hd<span class="sc">$</span>demog_grp <span class="ot">&lt;-</span> hd<span class="sc">$</span>ECCC<span class="sc">%&gt;%</span>factor<span class="sc">%&gt;%</span><span class="fu">as.numeric</span>() </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>hd[hd<span class="sc">$</span>herd<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;Itcha-Ilgachuz&quot;</span>),<span class="st">&quot;demog_grp&quot;</span>]<span class="ot">&lt;-</span><span class="dv">4</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>nsight_grp <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(hd<span class="sc">$</span>sight_grp))</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>ndemog_grp <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(hd<span class="sc">$</span>demog_grp))</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co"># Index for herd per demog group</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>hd <span class="ot">&lt;-</span> hd <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    <span class="fu">group_by</span>(demog_grp) <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hd_per_dg =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>nhd_per_demog_grp <span class="ot">&lt;-</span> hd <span class="sc">%&gt;%</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(demog_grp, hd_per_dg) <span class="sc">%&gt;%</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>    <span class="fu">group_by</span>(demog_grp) <span class="sc">%&gt;%</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">max_hd_num =</span> <span class="fu">max</span>(hd_per_dg)) <span class="sc">%&gt;%</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>    </span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#  Years of study</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>yrs <span class="ot">&lt;-</span>  <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(trt<span class="sc">$</span>year), <span class="at">to =</span> <span class="fu">max</span>(trt<span class="sc">$</span>year), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>nyr <span class="ot">&lt;-</span> <span class="fu">length</span>(yrs)</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>yr_idx <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> nyr, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>yr_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(yrs, yr_idx))</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co"># Age classes</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>nage <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co"># Restrict year range for trouble shooting</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a>rest_yr <span class="ot">&lt;-</span> nyr</span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>ntrt <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(trt<span class="sc">$</span>treatment))</span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co"># Generate treatment matrices</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a>mtrt <span class="ot">&lt;-</span> trt <span class="sc">%&gt;%</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(treatment <span class="sc">==</span> <span class="st">&quot;reduce moose&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd_num, yr_idx, applied) <span class="sc">%&gt;%</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">spread</span>(yr_idx, applied)</span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>mtrt <span class="ot">&lt;-</span> mtrt[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a>mtrt[<span class="fu">is.na</span>(mtrt)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a>wtrt <span class="ot">&lt;-</span> trt <span class="sc">%&gt;%</span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(treatment <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;reduce wolves&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd_num, yr_idx, applied) <span class="sc">%&gt;%</span></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">spread</span>(yr_idx, applied)</span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a>wtrt <span class="ot">&lt;-</span> wtrt[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a>wtrt[<span class="fu">is.na</span>(wtrt)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a>ptrt <span class="ot">&lt;-</span> trt <span class="sc">%&gt;%</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(treatment <span class="sc">==</span> <span class="st">&quot;pen&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd_num, yr_idx, applied) <span class="sc">%&gt;%</span></span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">spread</span>(yr_idx, applied)</span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a>ptrt <span class="ot">&lt;-</span> ptrt[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a>ptrt[<span class="fu">is.na</span>(ptrt)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a>ftrt <span class="ot">&lt;-</span> trt <span class="sc">%&gt;%</span></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(treatment <span class="sc">==</span> <span class="st">&quot;feed&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd_num, yr_idx, applied) <span class="sc">%&gt;%</span></span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">spread</span>(yr_idx, applied)</span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a>ftrt <span class="ot">&lt;-</span> ftrt[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-80"><a href="#cb2-80" tabindex="-1"></a>ftrt[<span class="fu">is.na</span>(ftrt)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-81"><a href="#cb2-81" tabindex="-1"></a></span>
<span id="cb2-82"><a href="#cb2-82" tabindex="-1"></a></span>
<span id="cb2-83"><a href="#cb2-83" tabindex="-1"></a>strt <span class="ot">&lt;-</span> trt <span class="sc">%&gt;%</span></span>
<span id="cb2-84"><a href="#cb2-84" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(treatment <span class="sc">==</span> <span class="st">&quot;sterilize wolves&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-85"><a href="#cb2-85" tabindex="-1"></a>  <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-86"><a href="#cb2-86" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(herd_num, yr_idx, applied) <span class="sc">%&gt;%</span></span>
<span id="cb2-87"><a href="#cb2-87" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">spread</span>(yr_idx, applied)</span>
<span id="cb2-88"><a href="#cb2-88" tabindex="-1"></a>strt <span class="ot">&lt;-</span> strt[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-89"><a href="#cb2-89" tabindex="-1"></a>strt[<span class="fu">is.na</span>(strt)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-90"><a href="#cb2-90" tabindex="-1"></a></span>
<span id="cb2-91"><a href="#cb2-91" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" tabindex="-1"></a>ttrt <span class="ot">&lt;-</span> trt <span class="sc">%&gt;%</span></span>
<span id="cb2-93"><a href="#cb2-93" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(treatment <span class="sc">==</span> <span class="st">&quot;transplant&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-94"><a href="#cb2-94" tabindex="-1"></a>  <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-95"><a href="#cb2-95" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(herd_num, yr_idx, applied) <span class="sc">%&gt;%</span></span>
<span id="cb2-96"><a href="#cb2-96" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">spread</span>(yr_idx, applied)</span>
<span id="cb2-97"><a href="#cb2-97" tabindex="-1"></a>ttrt <span class="ot">&lt;-</span> ttrt[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-98"><a href="#cb2-98" tabindex="-1"></a>ttrt[<span class="fu">is.na</span>(ttrt)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-99"><a href="#cb2-99" tabindex="-1"></a></span>
<span id="cb2-100"><a href="#cb2-100" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" tabindex="-1"></a><span class="co"># Recruitment</span></span>
<span id="cb2-102"><a href="#cb2-102" tabindex="-1"></a>rdat <span class="ot">&lt;-</span> afr <span class="sc">%&gt;%</span></span>
<span id="cb2-103"><a href="#cb2-103" tabindex="-1"></a>  <span class="co">#filter(!herd%in%&quot;Tonquin&quot;)%&gt;%</span></span>
<span id="cb2-104"><a href="#cb2-104" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">herd =</span> herd_num,</span>
<span id="cb2-105"><a href="#cb2-105" tabindex="-1"></a>        <span class="at">age =</span> <span class="cn">NA</span>, </span>
<span id="cb2-106"><a href="#cb2-106" tabindex="-1"></a>        <span class="at">sex =</span> <span class="dv">1</span>,</span>
<span id="cb2-107"><a href="#cb2-107" tabindex="-1"></a>        <span class="co">#mu = recruitment/100,</span></span>
<span id="cb2-108"><a href="#cb2-108" tabindex="-1"></a>        <span class="at">mu =</span> est,</span>
<span id="cb2-109"><a href="#cb2-109" tabindex="-1"></a>        <span class="co">#tau = 500) %&gt;%</span></span>
<span id="cb2-110"><a href="#cb2-110" tabindex="-1"></a>        <span class="at">tau =</span> <span class="dv">1</span><span class="sc">/</span>(sd<span class="sc">*</span>sd)) <span class="sc">%&gt;%</span></span>
<span id="cb2-111"><a href="#cb2-111" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-112"><a href="#cb2-112" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mu)) <span class="sc">%&gt;%</span></span>
<span id="cb2-113"><a href="#cb2-113" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(mu <span class="sc">!=</span> <span class="st">&quot;Inf&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-114"><a href="#cb2-114" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">year =</span> yr_idx, age, sex, mu, tau) <span class="sc">%&gt;%</span></span>
<span id="cb2-115"><a href="#cb2-115" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&lt;=</span> rest_yr) <span class="sc">%&gt;%</span></span>
<span id="cb2-116"><a href="#cb2-116" tabindex="-1"></a>    <span class="fu">arrange</span>(herd, year)</span>
<span id="cb2-117"><a href="#cb2-117" tabindex="-1"></a>rdat<span class="sc">$</span>tau[rdat<span class="sc">$</span>tau <span class="sc">==</span> <span class="st">&quot;Inf&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(rdat<span class="sc">$</span>tau[rdat<span class="sc">$</span>tau <span class="sc">!=</span> <span class="st">&quot;Inf&quot;</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-118"><a href="#cb2-118" tabindex="-1"></a>nr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(rdat)    </span>
<span id="cb2-119"><a href="#cb2-119" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" tabindex="-1"></a><span class="do">##mean for prior</span></span>
<span id="cb2-121"><a href="#cb2-121" tabindex="-1"></a>afr <span class="sc">%&gt;%</span></span>
<span id="cb2-122"><a href="#cb2-122" tabindex="-1"></a>  <span class="fu">filter</span>(season_int<span class="sc">==</span><span class="dv">1</span>,</span>
<span id="cb2-123"><a href="#cb2-123" tabindex="-1"></a>         year<span class="sc">&lt;=</span><span class="dv">2010</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-124"><a href="#cb2-124" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">meanR=</span><span class="fu">mean</span>(est))</span>
<span id="cb2-125"><a href="#cb2-125" tabindex="-1"></a></span>
<span id="cb2-126"><a href="#cb2-126" tabindex="-1"></a><span class="co"># Survival </span></span>
<span id="cb2-127"><a href="#cb2-127" tabindex="-1"></a>sdat <span class="ot">&lt;-</span> afs <span class="sc">%&gt;%</span></span>
<span id="cb2-128"><a href="#cb2-128" tabindex="-1"></a>  <span class="fu">filter</span>(est<span class="sc">&lt;</span><span class="fl">0.99</span> <span class="sc">&amp;</span> est<span class="sc">&gt;</span><span class="fl">0.5</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-129"><a href="#cb2-129" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">herd =</span> herd_num,</span>
<span id="cb2-130"><a href="#cb2-130" tabindex="-1"></a>        <span class="at">age =</span> <span class="dv">2</span>, </span>
<span id="cb2-131"><a href="#cb2-131" tabindex="-1"></a>        <span class="at">sex =</span> <span class="dv">1</span>,</span>
<span id="cb2-132"><a href="#cb2-132" tabindex="-1"></a>        <span class="at">mu =</span> est,</span>
<span id="cb2-133"><a href="#cb2-133" tabindex="-1"></a>        <span class="co">#tau = 100) %&gt;%</span></span>
<span id="cb2-134"><a href="#cb2-134" tabindex="-1"></a>        <span class="at">tau =</span> <span class="dv">1</span><span class="sc">/</span>(sd<span class="sc">*</span>sd)) <span class="sc">%&gt;%</span></span>
<span id="cb2-135"><a href="#cb2-135" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-136"><a href="#cb2-136" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mu)) <span class="sc">%&gt;%</span></span>
<span id="cb2-137"><a href="#cb2-137" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(mu <span class="sc">!=</span> <span class="st">&quot;Inf&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-138"><a href="#cb2-138" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">year =</span> yr_idx, age, sex, mu, tau) <span class="sc">%&gt;%</span></span>
<span id="cb2-139"><a href="#cb2-139" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&lt;=</span> rest_yr) <span class="sc">%&gt;%</span></span>
<span id="cb2-140"><a href="#cb2-140" tabindex="-1"></a>    <span class="fu">arrange</span>(herd, year)</span>
<span id="cb2-141"><a href="#cb2-141" tabindex="-1"></a>sdat<span class="sc">$</span>tau[sdat<span class="sc">$</span>tau <span class="sc">==</span> <span class="st">&quot;Inf&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(sdat<span class="sc">$</span>tau[sdat<span class="sc">$</span>tau <span class="sc">!=</span> <span class="st">&quot;Inf&quot;</span>])</span>
<span id="cb2-142"><a href="#cb2-142" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sdat)    </span>
<span id="cb2-143"><a href="#cb2-143" tabindex="-1"></a></span>
<span id="cb2-144"><a href="#cb2-144" tabindex="-1"></a><span class="co">#sdat$mu[sdat$mu == 1.0000000] &lt;- 0.999</span></span>
<span id="cb2-145"><a href="#cb2-145" tabindex="-1"></a></span>
<span id="cb2-146"><a href="#cb2-146" tabindex="-1"></a></span>
<span id="cb2-147"><a href="#cb2-147" tabindex="-1"></a></span>
<span id="cb2-148"><a href="#cb2-148" tabindex="-1"></a><span class="co"># Sightability</span></span>
<span id="cb2-149"><a href="#cb2-149" tabindex="-1"></a><span class="co"># Estimates of 1 are not usable here, not sure why they are left in or how this </span></span>
<span id="cb2-150"><a href="#cb2-150" tabindex="-1"></a><span class="co"># even works given qlogis(1) equals Inf</span></span>
<span id="cb2-151"><a href="#cb2-151" tabindex="-1"></a><span class="co"># We need to transform the uncertainty along with the mean, changes made in JAGS</span></span>
<span id="cb2-152"><a href="#cb2-152" tabindex="-1"></a>grp_p <span class="ot">&lt;-</span> sgt <span class="sc">%&gt;%</span> </span>
<span id="cb2-153"><a href="#cb2-153" tabindex="-1"></a>    <span class="fu">left_join</span>(hd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;herd&quot;</span>, <span class="st">&quot;herd_num&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-154"><a href="#cb2-154" tabindex="-1"></a>    <span class="fu">group_by</span>(sight_grp) <span class="sc">%&gt;%</span></span>
<span id="cb2-155"><a href="#cb2-155" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb2-156"><a href="#cb2-156" tabindex="-1"></a>      <span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb2-157"><a href="#cb2-157" tabindex="-1"></a>      <span class="at">mean_grp_p =</span> <span class="fu">mean</span>(est, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-158"><a href="#cb2-158" tabindex="-1"></a>      <span class="at">mean_grp_pvar =</span> <span class="fu">mean</span>(sd<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># If this works I am willing to bet it is only valid when performed on the variance and not the sd </span></span>
<span id="cb2-159"><a href="#cb2-159" tabindex="-1"></a>      <span class="at">mean_grp_ptau =</span> <span class="dv">1</span><span class="sc">/</span>(mean_grp_pvar)</span>
<span id="cb2-160"><a href="#cb2-160" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-161"><a href="#cb2-161" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-162"><a href="#cb2-162" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-163"><a href="#cb2-163" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(sight_grp, mean_grp_p, mean_grp_pvar, mean_grp_ptau) <span class="sc">%&gt;%</span></span>
<span id="cb2-164"><a href="#cb2-164" tabindex="-1"></a>    <span class="fu">arrange</span>(sight_grp)</span>
<span id="cb2-165"><a href="#cb2-165" tabindex="-1"></a>    </span>
<span id="cb2-166"><a href="#cb2-166" tabindex="-1"></a></span>
<span id="cb2-167"><a href="#cb2-167" tabindex="-1"></a>mean_grp_p <span class="ot">&lt;-</span> grp_p<span class="sc">$</span>mean_grp_p</span>
<span id="cb2-168"><a href="#cb2-168" tabindex="-1"></a>mean_grp_ptau <span class="ot">&lt;-</span> grp_p<span class="sc">$</span>mean_grp_ptau</span>
<span id="cb2-169"><a href="#cb2-169" tabindex="-1"></a></span>
<span id="cb2-170"><a href="#cb2-170" tabindex="-1"></a>sgt_grp_ind <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> nherd, <span class="at">ncol =</span> nyr)</span>
<span id="cb2-171"><a href="#cb2-171" tabindex="-1"></a><span class="cf">for</span>(sg <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sgt_grp_ind)){</span>
<span id="cb2-172"><a href="#cb2-172" tabindex="-1"></a>    sgt_grp_ind[sg,] <span class="ot">&lt;-</span> hd<span class="sc">$</span>sight_grp[hd<span class="sc">$</span>herd_num <span class="sc">==</span> sg]</span>
<span id="cb2-173"><a href="#cb2-173" tabindex="-1"></a>    }</span>
<span id="cb2-174"><a href="#cb2-174" tabindex="-1"></a></span>
<span id="cb2-175"><a href="#cb2-175" tabindex="-1"></a></span>
<span id="cb2-176"><a href="#cb2-176" tabindex="-1"></a>    </span>
<span id="cb2-177"><a href="#cb2-177" tabindex="-1"></a><span class="co"># Abundance -- separate out rows where no sightability data provided</span></span>
<span id="cb2-178"><a href="#cb2-178" tabindex="-1"></a></span>
<span id="cb2-179"><a href="#cb2-179" tabindex="-1"></a><span class="co"># Survey counts (have sightability)</span></span>
<span id="cb2-180"><a href="#cb2-180" tabindex="-1"></a>cdat <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb2-181"><a href="#cb2-181" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Sightability)) <span class="sc">%&gt;%</span></span>
<span id="cb2-182"><a href="#cb2-182" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">herd =</span> herd_num, </span>
<span id="cb2-183"><a href="#cb2-183" tabindex="-1"></a>        <span class="at">age =</span> <span class="cn">NA</span>, </span>
<span id="cb2-184"><a href="#cb2-184" tabindex="-1"></a>        <span class="at">sex =</span> <span class="cn">NA</span>,</span>
<span id="cb2-185"><a href="#cb2-185" tabindex="-1"></a>        <span class="at">mu =</span> <span class="fu">as.integer</span>(count),</span>
<span id="cb2-186"><a href="#cb2-186" tabindex="-1"></a>        <span class="at">tau =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-187"><a href="#cb2-187" tabindex="-1"></a>          count <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">/</span>((count<span class="sc">*</span><span class="fl">0.15</span>)<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb2-188"><a href="#cb2-188" tabindex="-1"></a>          count <span class="sc">%in%</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb2-189"><a href="#cb2-189" tabindex="-1"></a>        )</span>
<span id="cb2-190"><a href="#cb2-190" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb2-191"><a href="#cb2-191" tabindex="-1"></a>        <span class="co">#tau = 1/(sd*sd)) %&gt;%</span></span>
<span id="cb2-192"><a href="#cb2-192" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-193"><a href="#cb2-193" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">year =</span> yr_idx, age, sex, mu, tau) <span class="sc">%&gt;%</span></span>
<span id="cb2-194"><a href="#cb2-194" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&lt;=</span> rest_yr) <span class="sc">%&gt;%</span></span>
<span id="cb2-195"><a href="#cb2-195" tabindex="-1"></a>    <span class="fu">arrange</span>(herd, year)</span>
<span id="cb2-196"><a href="#cb2-196" tabindex="-1"></a></span>
<span id="cb2-197"><a href="#cb2-197" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cdat)</span>
<span id="cb2-198"><a href="#cb2-198" tabindex="-1"></a></span>
<span id="cb2-199"><a href="#cb2-199" tabindex="-1"></a></span>
<span id="cb2-200"><a href="#cb2-200" tabindex="-1"></a><span class="co"># Sightability data </span></span>
<span id="cb2-201"><a href="#cb2-201" tabindex="-1"></a>pdat <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb2-202"><a href="#cb2-202" tabindex="-1"></a>    <span class="fu">left_join</span>(hd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;herd&quot;</span>, <span class="st">&quot;herd_num&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-203"><a href="#cb2-203" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Sightability)) <span class="sc">%&gt;%</span></span>
<span id="cb2-204"><a href="#cb2-204" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">herd =</span> herd_num, </span>
<span id="cb2-205"><a href="#cb2-205" tabindex="-1"></a>        <span class="at">age =</span> <span class="cn">NA</span>, </span>
<span id="cb2-206"><a href="#cb2-206" tabindex="-1"></a>        <span class="at">sex =</span> <span class="cn">NA</span>,</span>
<span id="cb2-207"><a href="#cb2-207" tabindex="-1"></a>        <span class="at">mu =</span> Sightability,</span>
<span id="cb2-208"><a href="#cb2-208" tabindex="-1"></a>        <span class="at">tau =</span> <span class="dv">1</span><span class="sc">/</span>(sd<span class="sc">*</span>sd)) <span class="sc">%&gt;%</span></span>
<span id="cb2-209"><a href="#cb2-209" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-210"><a href="#cb2-210" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">year =</span> yr_idx, age, sex, mu, tau) <span class="sc">%&gt;%</span></span>
<span id="cb2-211"><a href="#cb2-211" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&lt;=</span> rest_yr) <span class="sc">%&gt;%</span></span>
<span id="cb2-212"><a href="#cb2-212" tabindex="-1"></a>    <span class="fu">arrange</span>(herd, year)</span>
<span id="cb2-213"><a href="#cb2-213" tabindex="-1"></a><span class="co">#pdat$pdat[pdat$pdat == 1] &lt;- 0.95  </span></span>
<span id="cb2-214"><a href="#cb2-214" tabindex="-1"></a>pdat<span class="sc">$</span>tau[pdat<span class="sc">$</span>tau <span class="sc">==</span> <span class="st">&quot;Inf&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(pdat<span class="sc">$</span>tau[pdat<span class="sc">$</span>tau <span class="sc">!=</span> <span class="st">&quot;Inf&quot;</span>])</span>
<span id="cb2-215"><a href="#cb2-215" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="fu">nrow</span>(pdat)</span>
<span id="cb2-216"><a href="#cb2-216" tabindex="-1"></a></span>
<span id="cb2-217"><a href="#cb2-217" tabindex="-1"></a><span class="co"># Minimum Estimates</span></span>
<span id="cb2-218"><a href="#cb2-218" tabindex="-1"></a>edat <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span></span>
<span id="cb2-219"><a href="#cb2-219" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.na</span>(Sightability)) <span class="sc">%&gt;%</span></span>
<span id="cb2-220"><a href="#cb2-220" tabindex="-1"></a>    <span class="fu">left_join</span>(hd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;herd&quot;</span>, <span class="st">&quot;herd_num&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-221"><a href="#cb2-221" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">herd =</span> herd_num, </span>
<span id="cb2-222"><a href="#cb2-222" tabindex="-1"></a>        <span class="at">age =</span> <span class="cn">NA</span>, </span>
<span id="cb2-223"><a href="#cb2-223" tabindex="-1"></a>        <span class="at">sex =</span> <span class="cn">NA</span>,</span>
<span id="cb2-224"><a href="#cb2-224" tabindex="-1"></a>        <span class="at">mu =</span> <span class="fu">as.integer</span>(count),</span>
<span id="cb2-225"><a href="#cb2-225" tabindex="-1"></a>        <span class="at">tau =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-226"><a href="#cb2-226" tabindex="-1"></a>          count <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">/</span>((count<span class="sc">*</span><span class="fl">0.2</span>)<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb2-227"><a href="#cb2-227" tabindex="-1"></a>          count <span class="sc">%in%</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">10</span></span>
<span id="cb2-228"><a href="#cb2-228" tabindex="-1"></a>        ),</span>
<span id="cb2-229"><a href="#cb2-229" tabindex="-1"></a>        <span class="co">#tau = 1/(sd*sd),</span></span>
<span id="cb2-230"><a href="#cb2-230" tabindex="-1"></a>        <span class="at">sight_grp =</span> sight_grp) <span class="sc">%&gt;%</span></span>
<span id="cb2-231"><a href="#cb2-231" tabindex="-1"></a>    <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-232"><a href="#cb2-232" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">year =</span> yr_idx, age, sex, mu, tau, sight_grp) <span class="sc">%&gt;%</span></span>
<span id="cb2-233"><a href="#cb2-233" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&lt;=</span> rest_yr) <span class="sc">%&gt;%</span></span>
<span id="cb2-234"><a href="#cb2-234" tabindex="-1"></a>    <span class="fu">arrange</span>(herd, year)</span>
<span id="cb2-235"><a href="#cb2-235" tabindex="-1"></a></span>
<span id="cb2-236"><a href="#cb2-236" tabindex="-1"></a>edat <span class="ot">&lt;-</span> edat<span class="sc">%&gt;%</span></span>
<span id="cb2-237"><a href="#cb2-237" tabindex="-1"></a>  <span class="fu">rbind</span>(edat<span class="sc">%&gt;%</span></span>
<span id="cb2-238"><a href="#cb2-238" tabindex="-1"></a>          <span class="fu">filter</span>((herd<span class="sc">==</span><span class="dv">19</span> <span class="sc">&amp;</span> year<span class="sc">==</span><span class="dv">48</span>))<span class="sc">%&gt;%</span></span>
<span id="cb2-239"><a href="#cb2-239" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year=</span><span class="dv">49</span>,<span class="at">mu=</span><span class="dv">99</span>, <span class="at">tau=</span><span class="fl">0.01</span>))</span>
<span id="cb2-240"><a href="#cb2-240" tabindex="-1"></a></span>
<span id="cb2-241"><a href="#cb2-241" tabindex="-1"></a>ne <span class="ot">&lt;-</span> <span class="fu">nrow</span>(edat)</span>
<span id="cb2-242"><a href="#cb2-242" tabindex="-1"></a></span>
<span id="cb2-243"><a href="#cb2-243" tabindex="-1"></a></span>
<span id="cb2-244"><a href="#cb2-244" tabindex="-1"></a><span class="co"># Survey timing: most are in March. Those NOT in March:</span></span>
<span id="cb2-245"><a href="#cb2-245" tabindex="-1"></a><span class="co"># 1 = March (reference), 2 = Fall, 3 = Spring</span></span>
<span id="cb2-246"><a href="#cb2-246" tabindex="-1"></a></span>
<span id="cb2-247"><a href="#cb2-247" tabindex="-1"></a>survey_timing <span class="ot">&lt;-</span> afr<span class="sc">%&gt;%</span></span>
<span id="cb2-248"><a href="#cb2-248" tabindex="-1"></a>  <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-249"><a href="#cb2-249" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(herd_num,yr_idx,season_int)<span class="sc">%&gt;%</span></span>
<span id="cb2-250"><a href="#cb2-250" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">expand.grid</span>(<span class="at">herd_num=</span>(<span class="dv">1</span><span class="sc">:</span>nherd)[<span class="sc">!</span>(<span class="dv">1</span><span class="sc">:</span>nherd)<span class="sc">%in%</span><span class="fu">unique</span>(afr<span class="sc">$</span>herd_num)],</span>
<span id="cb2-251"><a href="#cb2-251" tabindex="-1"></a>               <span class="at">yr_idx=</span>(<span class="dv">1</span><span class="sc">:</span>nyr)[<span class="sc">!</span>(<span class="dv">1</span><span class="sc">:</span>nyr)<span class="sc">%in%</span><span class="fu">unique</span>(afr<span class="sc">%&gt;%</span></span>
<span id="cb2-252"><a href="#cb2-252" tabindex="-1"></a>                                                   <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>))<span class="sc">%&gt;%</span><span class="fu">pull</span>(yr_idx))],</span>
<span id="cb2-253"><a href="#cb2-253" tabindex="-1"></a>               <span class="at">season_int=</span><span class="dv">1</span>))<span class="sc">%&gt;%</span></span>
<span id="cb2-254"><a href="#cb2-254" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">spread</span>(yr_idx, season_int)</span>
<span id="cb2-255"><a href="#cb2-255" tabindex="-1"></a>survey_timing <span class="ot">&lt;-</span> survey_timing[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-256"><a href="#cb2-256" tabindex="-1"></a>survey_timing[<span class="fu">is.na</span>(survey_timing)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-257"><a href="#cb2-257" tabindex="-1"></a></span>
<span id="cb2-258"><a href="#cb2-258" tabindex="-1"></a></span>
<span id="cb2-259"><a href="#cb2-259" tabindex="-1"></a></span>
<span id="cb2-260"><a href="#cb2-260" tabindex="-1"></a><span class="do">########## UPDATE 11/2/22</span></span>
<span id="cb2-261"><a href="#cb2-261" tabindex="-1"></a><span class="co"># Calves born in May</span></span>
<span id="cb2-262"><a href="#cb2-262" tabindex="-1"></a><span class="co"># May/Jun survey = Spring survey (age = 1 month) --- season_int = 3</span></span>
<span id="cb2-263"><a href="#cb2-263" tabindex="-1"></a><span class="co"># Oct survey = Fall survey (age = 5 months) ---- season_int = 2</span></span>
<span id="cb2-264"><a href="#cb2-264" tabindex="-1"></a><span class="co"># Mar survey = winter survey (age = 10 months) ---- season_int = 1</span></span>
<span id="cb2-265"><a href="#cb2-265" tabindex="-1"></a></span>
<span id="cb2-266"><a href="#cb2-266" tabindex="-1"></a>month_offset <span class="ot">&lt;-</span> survey_timing</span>
<span id="cb2-267"><a href="#cb2-267" tabindex="-1"></a>month_offset[month_offset <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb2-268"><a href="#cb2-268" tabindex="-1"></a>month_offset[month_offset <span class="sc">==</span> <span class="dv">2</span>] <span class="ot">&lt;-</span>  <span class="dv">5</span> <span class="co"># 5 units offset</span></span>
<span id="cb2-269"><a href="#cb2-269" tabindex="-1"></a>month_offset[month_offset <span class="sc">==</span> <span class="dv">3</span>] <span class="ot">&lt;-</span>  <span class="dv">9</span> <span class="co"># 9 units offset</span></span>
<span id="cb2-270"><a href="#cb2-270" tabindex="-1"></a></span>
<span id="cb2-271"><a href="#cb2-271" tabindex="-1"></a></span>
<span id="cb2-272"><a href="#cb2-272" tabindex="-1"></a><span class="co"># # Starting population size of each herd</span></span>
<span id="cb2-273"><a href="#cb2-273" tabindex="-1"></a><span class="co">#take average of all counts that occured within 3 years of first count per herd</span></span>
<span id="cb2-274"><a href="#cb2-274" tabindex="-1"></a><span class="co">#   Using the &quot;Est_CL&quot; column </span></span>
<span id="cb2-275"><a href="#cb2-275" tabindex="-1"></a><span class="co"># Starting population size of each herd</span></span>
<span id="cb2-276"><a href="#cb2-276" tabindex="-1"></a>meancount <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span></span>
<span id="cb2-277"><a href="#cb2-277" tabindex="-1"></a>    <span class="fu">arrange</span>(herd_num, year) <span class="sc">%&gt;%</span></span>
<span id="cb2-278"><a href="#cb2-278" tabindex="-1"></a>    <span class="fu">group_by</span>(herd_num) <span class="sc">%&gt;%</span></span>
<span id="cb2-279"><a href="#cb2-279" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">keep =</span> year <span class="sc">-</span> <span class="fu">min</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb2-280"><a href="#cb2-280" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(keep <span class="sc">&lt;</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-281"><a href="#cb2-281" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n1_mean =</span> <span class="fu">mean</span>(Est_CL, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-282"><a href="#cb2-282" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-283"><a href="#cb2-283" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-284"><a href="#cb2-284" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, herd_num, n1_mean) <span class="sc">%&gt;%</span></span>
<span id="cb2-285"><a href="#cb2-285" tabindex="-1"></a>    <span class="fu">right_join</span>(hd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;herd&quot;</span>, <span class="st">&quot;herd_num&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-286"><a href="#cb2-286" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n1_mean =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n1_mean), <span class="fu">mean</span>(n1_mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), n1_mean)) <span class="sc">%&gt;%</span></span>
<span id="cb2-287"><a href="#cb2-287" tabindex="-1"></a>    <span class="fu">arrange</span>(herd_num)</span>
<span id="cb2-288"><a href="#cb2-288" tabindex="-1"></a>n1s <span class="ot">&lt;-</span> meancount<span class="sc">$</span>n1_mean</span>
<span id="cb2-289"><a href="#cb2-289" tabindex="-1"></a></span>
<span id="cb2-290"><a href="#cb2-290" tabindex="-1"></a><span class="do">##starting age class distribution (sensitivity tested this in McNay et al. 2022 and it doesnt have a meaningful effect even if substantially changed)</span></span>
<span id="cb2-291"><a href="#cb2-291" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nherd, <span class="at">ncol =</span> nage)</span>
<span id="cb2-292"><a href="#cb2-292" tabindex="-1"></a><span class="cf">for</span>(h <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nherd){</span>
<span id="cb2-293"><a href="#cb2-293" tabindex="-1"></a>    n1[h,<span class="dv">1</span>] <span class="ot">&lt;-</span> (n1s[h]<span class="sc">*</span><span class="fl">0.5</span>)<span class="sc">*</span><span class="fl">0.15</span></span>
<span id="cb2-294"><a href="#cb2-294" tabindex="-1"></a>    n1[h,<span class="dv">2</span>] <span class="ot">&lt;-</span> (n1s[h]<span class="sc">*</span><span class="fl">0.64</span>)<span class="sc">*</span><span class="fl">0.85</span> </span>
<span id="cb2-295"><a href="#cb2-295" tabindex="-1"></a>    }</span>
<span id="cb2-296"><a href="#cb2-296" tabindex="-1"></a></span>
<span id="cb2-297"><a href="#cb2-297" tabindex="-1"></a></span>
<span id="cb2-298"><a href="#cb2-298" tabindex="-1"></a><span class="co"># Sex ratio</span></span>
<span id="cb2-299"><a href="#cb2-299" tabindex="-1"></a>srdat <span class="ot">&lt;-</span> sexratios<span class="sc">%&gt;%</span></span>
<span id="cb2-300"><a href="#cb2-300" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">herd =</span> herd_num,</span>
<span id="cb2-301"><a href="#cb2-301" tabindex="-1"></a>         <span class="at">mu =</span> sratio,</span>
<span id="cb2-302"><a href="#cb2-302" tabindex="-1"></a>         <span class="at">tau =</span> <span class="dv">1</span><span class="sc">/</span>(sratio.sd<span class="sc">*</span>sratio.sd)) <span class="sc">%&gt;%</span></span>
<span id="cb2-303"><a href="#cb2-303" tabindex="-1"></a>  <span class="fu">left_join</span>(yr_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;yrs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-304"><a href="#cb2-304" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mu)) <span class="sc">%&gt;%</span></span>
<span id="cb2-305"><a href="#cb2-305" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(mu <span class="sc">!=</span> <span class="st">&quot;Inf&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-306"><a href="#cb2-306" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">year =</span> yr_idx, mu, tau) <span class="sc">%&gt;%</span></span>
<span id="cb2-307"><a href="#cb2-307" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">&lt;=</span> rest_yr) <span class="sc">%&gt;%</span></span>
<span id="cb2-308"><a href="#cb2-308" tabindex="-1"></a>  <span class="fu">arrange</span>(herd, year)<span class="sc">%&gt;%</span></span>
<span id="cb2-309"><a href="#cb2-309" tabindex="-1"></a>  <span class="fu">distinct</span>(herd,year, <span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-310"><a href="#cb2-310" tabindex="-1"></a></span>
<span id="cb2-311"><a href="#cb2-311" tabindex="-1"></a>nsr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(srdat)  </span>
<span id="cb2-312"><a href="#cb2-312" tabindex="-1"></a></span>
<span id="cb2-313"><a href="#cb2-313" tabindex="-1"></a>meansr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2-314"><a href="#cb2-314" tabindex="-1"></a>meansr[<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> sexratio_summary[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb2-315"><a href="#cb2-315" tabindex="-1"></a>meansr[<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(sexratio_summary[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb2-316"><a href="#cb2-316" tabindex="-1"></a></span>
<span id="cb2-317"><a href="#cb2-317" tabindex="-1"></a></span>
<span id="cb2-318"><a href="#cb2-318" tabindex="-1"></a><span class="co">#  First year of data for each herd</span></span>
<span id="cb2-319"><a href="#cb2-319" tabindex="-1"></a>first_s <span class="ot">&lt;-</span> sdat <span class="sc">%&gt;%</span></span>
<span id="cb2-320"><a href="#cb2-320" tabindex="-1"></a>    <span class="fu">group_by</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb2-321"><a href="#cb2-321" tabindex="-1"></a>    <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb2-322"><a href="#cb2-322" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-323"><a href="#cb2-323" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-324"><a href="#cb2-324" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">first_s_year =</span> year) </span>
<span id="cb2-325"><a href="#cb2-325" tabindex="-1"></a>first_r <span class="ot">&lt;-</span> rdat <span class="sc">%&gt;%</span></span>
<span id="cb2-326"><a href="#cb2-326" tabindex="-1"></a>    <span class="fu">group_by</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb2-327"><a href="#cb2-327" tabindex="-1"></a>    <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb2-328"><a href="#cb2-328" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-329"><a href="#cb2-329" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-330"><a href="#cb2-330" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">first_r_year =</span> year)    </span>
<span id="cb2-331"><a href="#cb2-331" tabindex="-1"></a>first_c <span class="ot">&lt;-</span> cdat <span class="sc">%&gt;%</span></span>
<span id="cb2-332"><a href="#cb2-332" tabindex="-1"></a>    <span class="fu">group_by</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb2-333"><a href="#cb2-333" tabindex="-1"></a>    <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb2-334"><a href="#cb2-334" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-335"><a href="#cb2-335" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-336"><a href="#cb2-336" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">first_c_year =</span> year)    </span>
<span id="cb2-337"><a href="#cb2-337" tabindex="-1"></a>first_e <span class="ot">&lt;-</span> edat <span class="sc">%&gt;%</span></span>
<span id="cb2-338"><a href="#cb2-338" tabindex="-1"></a>    <span class="fu">group_by</span>(herd) <span class="sc">%&gt;%</span></span>
<span id="cb2-339"><a href="#cb2-339" tabindex="-1"></a>    <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb2-340"><a href="#cb2-340" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-341"><a href="#cb2-341" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-342"><a href="#cb2-342" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(herd, <span class="at">first_e_year =</span> year)</span>
<span id="cb2-343"><a href="#cb2-343" tabindex="-1"></a></span>
<span id="cb2-344"><a href="#cb2-344" tabindex="-1"></a>first_per_herd <span class="ot">&lt;-</span> first_s <span class="sc">%&gt;%</span></span>
<span id="cb2-345"><a href="#cb2-345" tabindex="-1"></a>    <span class="fu">full_join</span>(first_r, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-346"><a href="#cb2-346" tabindex="-1"></a>    <span class="fu">full_join</span>(first_c, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-347"><a href="#cb2-347" tabindex="-1"></a>    <span class="fu">full_join</span>(first_e, <span class="at">by =</span> <span class="st">&quot;herd&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-348"><a href="#cb2-348" tabindex="-1"></a>    <span class="fu">rowwise</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb2-349"><a href="#cb2-349" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">first_yr =</span> <span class="fu">min</span>(first_s_year, first_r_year, first_c_year, first_e_year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-350"><a href="#cb2-350" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-351"><a href="#cb2-351" tabindex="-1"></a>    <span class="fu">arrange</span>(herd)<span class="sc">%&gt;%</span></span>
<span id="cb2-352"><a href="#cb2-352" tabindex="-1"></a>  <span class="fu">left_join</span>(hd<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">name=</span>herd,<span class="at">herd=</span>herd_num))<span class="sc">%&gt;%</span></span>
<span id="cb2-353"><a href="#cb2-353" tabindex="-1"></a>  <span class="fu">left_join</span>(yr_df<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">first_yr=</span>yr_idx, yrs))</span>
<span id="cb2-354"><a href="#cb2-354" tabindex="-1"></a>first <span class="ot">&lt;-</span> first_per_herd<span class="sc">$</span>first_yr</span>
<span id="cb2-355"><a href="#cb2-355" tabindex="-1"></a></span>
<span id="cb2-356"><a href="#cb2-356" tabindex="-1"></a>first <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>,nherd)</span>
<span id="cb2-357"><a href="#cb2-357" tabindex="-1"></a></span>
<span id="cb2-358"><a href="#cb2-358" tabindex="-1"></a></span>
<span id="cb2-359"><a href="#cb2-359" tabindex="-1"></a><span class="co">#  First year of treatment for each herd</span></span>
<span id="cb2-360"><a href="#cb2-360" tabindex="-1"></a>treatment_start<span class="ot">&lt;-</span> trt<span class="sc">%&gt;%</span></span>
<span id="cb2-361"><a href="#cb2-361" tabindex="-1"></a>  <span class="fu">filter</span>(applied<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span>treatment<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;transplant&quot;</span>,<span class="st">&quot;reduce moose&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb2-362"><a href="#cb2-362" tabindex="-1"></a>  <span class="fu">group_by</span>(herd_num)<span class="sc">%&gt;%</span></span>
<span id="cb2-363"><a href="#cb2-363" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">yr=</span><span class="fu">min</span>(year)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">%&gt;%</span> <span class="do">##year before trt starts</span></span>
<span id="cb2-364"><a href="#cb2-364" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">tibble</span>(<span class="at">herd_num=</span><span class="dv">1</span><span class="sc">:</span>nherd,</span>
<span id="cb2-365"><a href="#cb2-365" tabindex="-1"></a>                    <span class="at">yr_fill=</span><span class="dv">2021</span>),</span>
<span id="cb2-366"><a href="#cb2-366" tabindex="-1"></a>             <span class="at">by=</span><span class="st">&quot;herd_num&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-367"><a href="#cb2-367" tabindex="-1"></a>  <span class="fu">left_join</span>(hd<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">name=</span>herd,herd_num))<span class="sc">%&gt;%</span></span>
<span id="cb2-368"><a href="#cb2-368" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yrs=</span><span class="fu">case_when</span>(<span class="fu">is.na</span>(yr)<span class="sc">~</span>yr_fill,</span>
<span id="cb2-369"><a href="#cb2-369" tabindex="-1"></a>                       name<span class="sc">%in%</span><span class="st">&quot;Columbia North&quot;</span><span class="sc">~</span><span class="dv">2004</span>, <span class="do">##CN reduce moose did work so keep this one</span></span>
<span id="cb2-370"><a href="#cb2-370" tabindex="-1"></a>                      <span class="cn">TRUE</span><span class="sc">~</span>yr))<span class="sc">%&gt;%</span></span>
<span id="cb2-371"><a href="#cb2-371" tabindex="-1"></a>  <span class="fu">left_join</span>(yr_df)<span class="sc">%&gt;%</span></span>
<span id="cb2-372"><a href="#cb2-372" tabindex="-1"></a>  <span class="fu">arrange</span>(herd_num)<span class="sc">%&gt;%</span></span>
<span id="cb2-373"><a href="#cb2-373" tabindex="-1"></a>  <span class="fu">pull</span>(yr_idx)</span>
<span id="cb2-374"><a href="#cb2-374" tabindex="-1"></a></span>
<span id="cb2-375"><a href="#cb2-375" tabindex="-1"></a>startmean <span class="ot">&lt;-</span> first_per_herd<span class="sc">$</span>first_yr</span>
<span id="cb2-376"><a href="#cb2-376" tabindex="-1"></a></span>
<span id="cb2-377"><a href="#cb2-377" tabindex="-1"></a>    </span>
<span id="cb2-378"><a href="#cb2-378" tabindex="-1"></a>nyr <span class="ot">&lt;-</span> rest_yr</span></code></pre></div>
<h2 id="gather-data-inputs-in-a-list">Gather data inputs in a list</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>ipm_dat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="at">nherd =</span> nherd,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="at">nyr =</span> nyr,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="at">first =</span> first,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="at">month_offset =</span> month_offset,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="at">treatment_start=</span>treatment_start,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="at">nc =</span> nc, </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="at">ne =</span> ne,</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="at">ns =</span> ns,</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    <span class="at">nr =</span> nr,</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    <span class="at">nsr =</span> nsr,</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    </span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>    <span class="at">nsight_grp =</span> nsight_grp,</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    <span class="at">ndemog_grp =</span> ndemog_grp,</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>    <span class="at">sight_grp =</span> hd<span class="sc">$</span>sight_grp,</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>    <span class="at">demog_grp =</span> hd<span class="sc">$</span>demog_grp,</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>    <span class="at">mean_grp_p =</span> mean_grp_p,</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>    <span class="at">mean_grp_ptau =</span> mean_grp_ptau,</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>    <span class="at">meansr =</span> meansr,</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>    </span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>    <span class="at">n1 =</span> n1, </span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    <span class="at">cdat =</span> cdat,</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    <span class="at">edat =</span> edat,</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>    <span class="at">sdat =</span> sdat,</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>    <span class="at">srdat =</span> srdat,</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>    <span class="at">pdat =</span> pdat,</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>    <span class="at">rdat =</span> rdat,</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>    </span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>    <span class="at">mtrt =</span> mtrt, </span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>    <span class="at">wtrt =</span> wtrt,</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>    <span class="at">ptrt =</span> ptrt, </span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>    <span class="at">ftrt =</span> ftrt,</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>    <span class="at">strt =</span> strt,</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>    <span class="at">ttrt =</span> ttrt)</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>    </span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>    </span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#  Initial values for N to avoid parent node erros</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#  Indexing was off here</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>Nst <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA_integer_</span>, <span class="fu">c</span>(nherd, nyr, nage))</span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="cf">for</span>(h <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nherd) {</span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>  <span class="cf">for</span>(a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nage) {</span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>    Nst[h, first[h]<span class="sc">:</span>nyr, a] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(</span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a>      <span class="fu">max</span>(</span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a>        <span class="fu">c</span>(n1[h, a], cdat<span class="sc">$</span>mu[cdat<span class="sc">$</span>herd <span class="sc">==</span> h], edat<span class="sc">$</span>mu[edat<span class="sc">$</span>herd <span class="sc">==</span> h])))  </span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>  }</span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>}</span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>ipm_inits <span class="ot">&lt;-</span> <span class="cf">function</span>(){ </span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a>    <span class="at">N =</span> Nst</span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a>    )</span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a>}</span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a><span class="co">#  Model parameters to monitor</span></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a>model_parms <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a>    <span class="st">&quot;adj_totNMF&quot;</span>, <span class="st">&quot;totN&quot;</span>, <span class="st">&quot;N&quot;</span>, </span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a>    <span class="st">&quot;totCalves&quot;</span>, <span class="st">&quot;totAdults&quot;</span>, <span class="st">&quot;totAdultsMF&quot;</span>, <span class="st">&quot;totCalvesMF&quot;</span>, <span class="st">&quot;totNMF&quot;</span>, </span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a>    <span class="st">&quot;lambda&quot;</span>, <span class="st">&quot;logla&quot;</span>,</span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a>    </span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a>    <span class="st">&quot;S&quot;</span>, <span class="st">&quot;R&quot;</span>,  <span class="st">&quot;R_adj&quot;</span>,</span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a>    <span class="st">&quot;p_mu&quot;</span>, <span class="st">&quot;sight_est&quot;</span>, <span class="st">&quot;p&quot;</span>,</span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a>    </span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a>    <span class="st">&quot;muS&quot;</span>, <span class="st">&quot;muR&quot;</span>,</span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a>    </span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a>    <span class="st">&quot;surv_yr_dg&quot;</span>, <span class="st">&quot;recruit_yr_dg&quot;</span>,</span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a>    <span class="st">&quot;surv_tau_yr_dg&quot;</span>, <span class="st">&quot;recruit_tau_yr_dg&quot;</span>,</span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a>    <span class="st">&quot;surv_hd&quot;</span>, <span class="st">&quot;recruit_hd&quot;</span>,</span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a>    </span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a>    <span class="st">&quot;surv_sd_yr_dg&quot;</span>,<span class="st">&quot;sight_tau_yr_sg&quot;</span>,</span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a>    </span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a>    <span class="st">&quot;offset&quot;</span>,</span>
<span id="cb3-79"><a href="#cb3-79" tabindex="-1"></a>    </span>
<span id="cb3-80"><a href="#cb3-80" tabindex="-1"></a>    <span class="st">&quot;pred_totNMF&quot;</span>,</span>
<span id="cb3-81"><a href="#cb3-81" tabindex="-1"></a>    <span class="st">&quot;pred_totCalvesMF&quot;</span>,</span>
<span id="cb3-82"><a href="#cb3-82" tabindex="-1"></a>    <span class="st">&quot;pred_totAdultsMF&quot;</span>,</span>
<span id="cb3-83"><a href="#cb3-83" tabindex="-1"></a>    <span class="st">&quot;mean_R&quot;</span>,</span>
<span id="cb3-84"><a href="#cb3-84" tabindex="-1"></a>    <span class="st">&quot;mean_S&quot;</span>,</span>
<span id="cb3-85"><a href="#cb3-85" tabindex="-1"></a>    <span class="st">&quot;sexratio&quot;</span>,</span>
<span id="cb3-86"><a href="#cb3-86" tabindex="-1"></a>    </span>
<span id="cb3-87"><a href="#cb3-87" tabindex="-1"></a>    <span class="st">&quot;mtrt_eff_s&quot;</span>, <span class="st">&quot;mtrt_eff_r&quot;</span>,</span>
<span id="cb3-88"><a href="#cb3-88" tabindex="-1"></a>    <span class="st">&quot;wtrt_eff_s&quot;</span>, <span class="st">&quot;wtrt_eff_r&quot;</span>,</span>
<span id="cb3-89"><a href="#cb3-89" tabindex="-1"></a>    <span class="st">&quot;ptrt_eff_s&quot;</span>, <span class="st">&quot;ptrt_eff_r&quot;</span>,</span>
<span id="cb3-90"><a href="#cb3-90" tabindex="-1"></a>    <span class="st">&quot;ftrt_eff_s&quot;</span>, <span class="st">&quot;ftrt_eff_r&quot;</span>,</span>
<span id="cb3-91"><a href="#cb3-91" tabindex="-1"></a>    <span class="st">&quot;strt_eff_s&quot;</span>, <span class="st">&quot;strt_eff_r&quot;</span>,</span>
<span id="cb3-92"><a href="#cb3-92" tabindex="-1"></a>    <span class="st">&quot;ttrt_eff_s&quot;</span>, <span class="st">&quot;ttrt_eff_r&quot;</span>,</span>
<span id="cb3-93"><a href="#cb3-93" tabindex="-1"></a>    </span>
<span id="cb3-94"><a href="#cb3-94" tabindex="-1"></a>    <span class="st">&quot;moosewolf&quot;</span>,</span>
<span id="cb3-95"><a href="#cb3-95" tabindex="-1"></a>    <span class="st">&quot;penwolf&quot;</span></span>
<span id="cb3-96"><a href="#cb3-96" tabindex="-1"></a>    )</span></code></pre></div>
<h2 id="run-ipm">Run IPM</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># nth &lt;- 90</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># nbu &lt;- 30000</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># nch &lt;- 3</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># nad &lt;- 60000</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># nit &lt;- 400000</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># nth &lt;- 1</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co"># nbu &lt;- 200</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># nch &lt;- 3</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co"># nad &lt;- 100</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co"># nit &lt;- 300</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>nth <span class="ot">&lt;-</span> <span class="dv">90</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>nbu <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>nch <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>nad <span class="ot">&lt;-</span> <span class="dv">60000</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>nit <span class="ot">&lt;-</span> <span class="dv">400000</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>out <span class="ot">&lt;-</span> jagsUI<span class="sc">::</span><span class="fu">jags</span>(<span class="at">data=</span>ipm_dat, </span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>    <span class="at">inits =</span> ipm_inits,</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    <span class="at">parameters.to.save=</span>model_parms,</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    <span class="at">model.file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;jags/BCAB_IPM_20231211.txt&quot;</span>),</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>    <span class="at">n.chains =</span> nch,</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    <span class="at">n.cores =</span> nch,</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>    <span class="at">n.iter =</span> nit,</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>    <span class="at">n.burnin =</span> nbu,</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>    <span class="at">n.thin =</span> nth,</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>    <span class="at">n.adapt =</span> nad)</span></code></pre></div>
<h2 id="save-outputs">Save outputs</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#mcmcplots::mcmcplot(out$samples, par = c(&quot;S&quot;, &quot;R&quot;, &quot;totNMF&quot;)) </span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">saveRDS</span>(out, <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;jags/output/BCAB_CaribouIPM_23update.rds&quot;</span>))</span></code></pre></div>

</body>
</html>
